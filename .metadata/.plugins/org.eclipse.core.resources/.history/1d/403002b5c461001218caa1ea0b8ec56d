package com.example;

import javax.microedition.khronos.opengles.GL10;

import com.example.R;


import rajawali.BaseObject3D;
import rajawali.materials.ParticleMaterial;
import rajawali.primitives.Plane;
import rajawali.renderer.RajawaliRenderer;
import android.content.Context;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.opengl.GLES20;



public class WallpaperRenderer extends RajawaliRenderer{
	
	private BaseObject3D water1;
	private ParticleMaterial  waterMat;
	private float[] waterUVs;
	private float[][] UVTiles;

	private int tileIndex = 0, frameCounter = 0;
	
	public WallpaperRenderer(Context context) {
		super(context);
		setFrameRate(30);
		setBackgroundColor(0x666666);
	}
		
	public void initScene() {
	
		mCamera.setPosition(0, 15, -15);
		mCamera.setLookAt(0,0,0);
		
		Bitmap waterTex = BitmapFactory.decodeResource(mContext.getResources(), R.drawable.wateratlas);
		rajawali.materials.TextureInfo waterTexture = mTextureManager.addTexture(waterTex);
		
		waterMat = new ParticleMaterial(true);
		waterMat.addTexture(waterTexture);
		waterMat.setTileSize(.25f);
		waterMat.setNumTileRows(4);
		
		water1 = new Plane(10,10,1,1);
		water1.getGeometry().setTextureCoords(new float[]{   0f, .25f, .25f, .25f,   0f,   0f, .25f,   0f });
		water1.setMaterial(waterMat);
		water1.setRotation(0, 90, -90);

//		UVTiles    = new float [16][];
//		
//		for(int j = 0; j <  UVTiles.length; j++){
//    		if(j%4 == 0) {
//    			waterUVs = new float[] {   0f, (.25f+((j/4)*.25f)), .25f, (.25f+((j/4)*.25f)),   0f,   (0f+((j/4)*.25f)), .25f,   (0f+((j/4)*.25f)) };
//	    	}else{
//	    		for(int i = 0; i < waterUVs.length; i++) {
//					if ( i%2 == 0){
//						waterUVs[i]+=.25f;
//						if (waterUVs[i] > 1) waterUVs[i]= 0;
//					}
//				}
//	    	}
//    		UVTiles[j] = new float[] { waterUVs[0], waterUVs[1], waterUVs[2], waterUVs[3], waterUVs[4], waterUVs[5], waterUVs[6], waterUVs[7] };
//    	}
	    addChild(water1);

	}
	
	@Override
	public void onDrawFrame(GL10 glUnused) {
			super.onDrawFrame(glUnused);
//			if(frameCounter%4 == 0) waterMotion();
			waterMat.setCurrentFrame(frameCounter);
			waterMat.setTime(frameCounter*.1f);
			waterMat.setCameraPosition(mCamera.getPosition());
			frameCounter++;
	    	if(frameCounter == 16) frameCounter = 0;
	}
	
	private void waterMotion() {
    	if(tileIndex == 16) tileIndex = 0;
		water1.getGeometry().setTextureCoords(UVTiles[tileIndex]);
//		System.out.println(tileIndex+")  "+UVTiles[tileIndex][0]+", "+UVTiles[tileIndex][1]+", "+UVTiles[tileIndex][2]+", "+UVTiles[tileIndex][3]+", "+UVTiles[tileIndex][4]+", "+UVTiles[tileIndex][5]+", "+UVTiles[tileIndex][6]+", "+UVTiles[tileIndex][7]);
		water1.reload();
    	tileIndex++;

	}
	

}